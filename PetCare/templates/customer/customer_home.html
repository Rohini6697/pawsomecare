{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pawsome Care | Customer Dashboard</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/customer/customer_home.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="logo-wrapper">
        <img src="{% static 'images/pawsomecare-logo.png' %}" class="logo-img">
        <h2 class="logo">Pawsome<span>Care</span></h2>
    </div>

    <ul class="nav-links">
        <li><a href="{% url 'customer_home' %}">Home</a></li>
        <li><a href="{% url 'my_pets' %}">My Pets</a></li>
        <li><a href="{% url 'service_bookings' %}">Bookings</a></li>
        <li><a href="{% url 'shop' %}">Shop</a></li>
        <li><a href="{% url 'cart' %}">Cart</a></li>
    </ul>

    <a href="{% url 'goback' %}" class="btn-secondary">Logout</a>
</nav>

<!-- VOICE HINT -->
<div class="voice-hint" id="voiceHint">
    Tap ğŸ¤ and speak (example: â€œBook grooming for Brunoâ€)
</div>

<!-- VOICE BUTTON -->
<button class="voice-btn" id="voiceBtn">ğŸ¤ Speak</button>

<!-- VOICE BOX -->
<div class="voice-box" id="voiceBox">
    <h4>ğŸ¤– Pawla says</h4>
    <p id="assistantText"></p>
</div>

<!-- HERO -->
<section class="hero">
    <div class="hero-content">
        <h1>
            Everything Your Pet Needs<br>
            <span class="highlight">One Trusted Platform</span>
        </h1>
        <p>Book services and shop using voice or click.</p>

        <div class="hero-actions">
            <button class="btn-primary">Book a Service</button>
            <button class="btn-outline">Add a Pet</button>
        </div>
    </div>

    <div class="hero-image">
        <img src="https://t3.ftcdn.net/jpg/04/18/06/84/360_F_418068474_VIWD3loz21dusicbe43VnAsAc9uZudyF.jpg">
    </div>
</section>

<!-- DASHBOARD -->
<section class="dashboard-actions">
    <div class="action-card">
        <h3>ğŸ¾ My Pets</h3>
        <p>Manage registered pets.</p>
    </div>

    <div class="action-card">
        <h3>ğŸ“… Services</h3>
        <p>Grooming, walking, vet visits.</p>
    </div>

    <div class="action-card">
        <h3>ğŸ›’ Pet Store</h3>
        <p>Food, toys & accessories.</p>
    </div>

    <div class="action-card">
        <h3>ğŸ“Š Reports</h3>
        <p>Daily health & activity.</p>
    </div>
</section>

<footer>
    <p>Â© 2025 Pawsome Care. All Rights Reserved.</p>
</footer>

<!-- ================= VOICE ASSISTANT JS ================= -->
<script>
const voiceBtn = document.getElementById("voiceBtn");
const voiceBox = document.getElementById("voiceBox");
const assistantText = document.getElementById("assistantText");
const voiceHint = document.getElementById("voiceHint");

let recognition;
let listening = false;

window.onload = () => {
    voiceHint.style.display = "block";
    setTimeout(() => voiceHint.style.display = "none", 4000);
};

voiceBtn.addEventListener("click", () => {

    if (!("webkitSpeechRecognition" in window)) {
        alert("Please use Google Chrome for voice support.");
        return;
    }

    if (listening) {
        recognition.stop();
        speechSynthesis.cancel();
        resetUI();
        return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;

    const welcome = new SpeechSynthesisUtterance(
        "Hi, I am Pawla. You can book pet services or buy products using your voice."
    );

    assistantText.innerText = welcome.text;
    voiceBox.style.display = "block";
    speechSynthesis.speak(welcome);

    voiceBtn.classList.add("listening");
    voiceBtn.innerText = "ğŸ¤ Listening...";
    listening = true;

    welcome.onend = () => recognition.start();

    recognition.onresult = (event) => {
        const command = event.results[0][0].transcript;
        assistantText.innerText = `You said: "${command}"`;

        // ğŸ”— SEND TO DJANGO
        fetch("/ai/intent/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCSRFToken()
            },
            body: JSON.stringify({ command: command })
        })
        .then(res => res.json())
        .then(data => {
    console.log("Backend response:", data);

    assistantText.innerText = data.reply;

    const reply = new SpeechSynthesisUtterance(data.reply);
    reply.rate = 1.05;
    reply.pitch = 1.2;
    speechSynthesis.speak(reply);
})

        .catch(err => {
            assistantText.innerText = "Sorry, something went wrong.";
            console.error(err);
        });

        resetUI();
    };

    recognition.onerror = resetUI;
    recognition.onend = resetUI;
});

function resetUI() {
    listening = false;
    voiceBtn.classList.remove("listening");
    voiceBtn.innerText = "ğŸ¤ Speak";
}

// CSRF helper
function getCSRFToken() {
    return document.cookie
        .split("; ")
        .find(row => row.startsWith("csrftoken="))
        ?.split("=")[1];
}
</script>


</body>
</html>
